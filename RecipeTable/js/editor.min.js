jQuery(document).ready(function(f){var a;var e=800;f(document).on("click",".zrdn-add-author",function(){var i=f(".zrdn-template").get(0).outerHTML;f(this).closest(".field-group").find(".zrdn-author-frame").append(i);f(this).closest(".field-group").find(".zrdn-author-frame .zrdn-hidden").removeClass("zrdn-hidden")});f(document).on("click",".zrdn-delete-author",function(){f(this).closest(".zrdn-author-container").remove()});f.fn.outerHTML=function(){return(!this.length)?this:(this[0].outerHTML||(function(i){var k=document.createElement("div");k.appendChild(i.cloneNode(true));var j=k.innerHTML;k=null;return j})(this[0]))};f(".zrdn-field-textarea").on("paste",function(j){var i=f(this);window.setTimeout(function(){var k=i.val().split(/\n/);var m=[];for(var l=0;l<k.length;l++){if(/\S/.test(k[l])){m.push(f.trim(k[l]))}}var o=m.join("\n");i.val(o)},500)});f(document).on("click",".zrdn-tablinks",function(){f(".zrdn-tablinks").removeClass("active");f(this).addClass("active");f(".zrdn-tabcontent").removeClass("active");f("#"+f(this).data("tab")).addClass("active");f("input[name=zrdn_active_tab]").val(f(this).data("tab"))});var g=f("#zrdn-preview");b();function b(l){l=typeof l!=="undefined"?l:false;if(g.length){var n;var i=[];f(".zrdn-field input").each(function(){var o=f(this).attr("name");if(typeof o==="undefined"){return}n=h(o,f(this).val());i.push(n)});f(".zrdn-field textarea").each(function(){if(f(this).hasClass("wp-editor-area")){return}var o=f(this).attr("name");if(typeof o==="undefined"){return}n=h(o,d(f(this)));i.push(n)});if(l){i.push(l)}n=h("recipe_id",f("input[name=zrdn_recipe_id]").val());i.push(n);var m=f("input[name=zrdn_post_permalink]").val();if(m.length===0){return}var j=m+"?mode=zrdn-preview";for(var k in i){if(i.hasOwnProperty(k)){n=i[k];j+=("&"+n.name+"="+n.value)}}g.html('<iframe id="preview_iframe" width="1024" height="0" src="'+j+'"></iframe>');g.find("iframe").attr("src",j).on("load",function(){var o=document.getElementById("preview_iframe");c(o);g.animate({height:"768px"})})}}setTimeout(function(){if(typeof tinymce==="undefined"){return}for(var j=0;j<tinymce.editors.length;j++){tinymce.editors[j].onChange.add(function(i,m){var k=i.id;var l=h(k,i.getContent());b(l)});tinymce.editors[j].onKeyUp.add(function(i,m){var k=i.id;var l=h(k,i.getContent());b(l)})}},1000);function c(k){var i=k.contentWindow.document.body||k.contentDocument.body,j=f(i).height();if(k.oHeight!==j){f(k).height(0);k.style.height=0;f(k).height(j);k.style.height=parseInt(j)+200+"px";k.oHeight=j}}f(document).on("keyup","input[type=text]",function(i){clearTimeout(a);a=setTimeout(b,e)});f(document).on("keydown","input[type=text]",function(i){clearTimeout(a)});f(document).on("keyup mouseup","input[type=number]",function(i){clearTimeout(a);a=setTimeout(b,e)});f(document).on("keydown mousedown","input[type=number]",function(i){clearTimeout(a)});f(document).on("keyup","textarea",function(i){clearTimeout(a);a=setTimeout(b,e)});f(document).on("keydown","textarea",function(i){clearTimeout(a)});function h(i,j){var k=new Object();k.name=i.replace("zrdn_","");k.value=encodeURIComponent(j);return k}function d(j){var s="UL";if(j.attr("name").indexOf("instructions")!=-1){s=f("input[name=zrdn_instructions_list_type]").val()}else{s=f("input[name=zrdn_ingredients_list_type]").val()}var r=j.val();var k="";var q=r.split("\n");q=q.filter(Boolean);q.forEach(function(u){if(u.substring(0,1)==="!"){k+="</"+s+"><b>"+u.substring(1)+"</b><"+s+">"}else{if(u.substring(0,1)==="%"){var v=/(?:%)([http|https?:\/\/=?\w.-]+(?:\.[\w\.-]+)+[\w\-\._~:\/?#[\]@!\$&'\(\)\*\+,;=.\/]+[a-zA-N])/g;var t=u.match(v);if(t){var i=t[0];var w=i.substring(1);k+="<li>"+u.replace(i,'<img style="max-width:100%" src="'+w+'">')+"</li>"}}else{k+="<li>"+u+"</li>"}}});if(k.length){var l;var p=/(\*[a-zA-Z\-\_\(\)\<\>\/\\\$\!\@\#\:\;\.\,\?\+\=]*\*)/g;var n=k.match(p);if(n&&n.length){for(l=0;l<n.length;l++){var m=n[l];var o=m;o=o.replace(/\*$/i,"</b>").replace(/^\*/i,"<b>");k=k.replace(m,o)}}p=/\[([^\]\|\[]*)\|([^\]\|\[]*)\]/g;n=k.match(p);if(n&&n.length){for(l=0;l<n.length;l++){k=k.replace(/\[([^\]\|\[]*)\|([^\]\|\[]*)\]/i,'<a target="_blank" href="$2">$1</a>')}}p=/(\_[a-zA-Z\-\_\(\)\<\>\/\\\$\!\@\#\:\;\.\,\?\+\=]*\_)/g;n=k.match(p);if(n&&n.length){for(l=0;l<n.length;l++){var m=n[l];if(m==="_placeholder_"){return}var o=m;o=o.replace(/\_$/i,"</i>").replace(/^\_/i,"<i>");k=k.replace(m,o)}}}console.log(s);k="<"+s+">"+k+"</"+s+">";console.log(k);return k}f(document).on("click",".zrdn-image-reset",function(){var l=f(this);var j=l.closest(".zrdn-field");var i=j.find(".zrdn-image-upload-field");var k=i.attr("name");j.find(".zrdn-preview-snippet").attr("src",zrdn_editor.image_placeholder);f("input[name="+k+"_id]").val("");f("input[name="+k+"]").val("")});f(document).on("click",".zrdn-image-uploader",function(){var m=f(this);var j=m.closest(".zrdn-field");var i=j.find(".zrdn-image-upload-field");var l=i.data("size");var k=i.attr("name");j.find(".zrdn-image-resolution-warning").hide();media_uploader=wp.media({frame:"post",state:"insert",multiple:false});media_uploader.on("insert",function(){j.append('<div class="loading-gif"></div>');var q=media_uploader.state().get("selection").length;var n=media_uploader.state().get("selection").models;for(var p=0;p<q;p++){var o=n[p].id;var r=false;console.log(n[p]);if(n[p].attributes.sizes.hasOwnProperty(l)){r=n[p].attributes.sizes[l]}else{if(n[p].attributes.sizes.hasOwnProperty(l+"_s")){r=n[p].attributes.sizes[l+"_s"]}else{if(n[p].attributes.sizes.hasOwnProperty("thumbnail")){r=n[p].attributes.sizes.thumbnail}}}if(r){var s=r.url;j.find(".zrdn-preview-snippet").attr("src",s);f("input[name="+k+"_id]").val(o);f("input[name="+k+"]").val(s)}else{j.find(".zrdn-image-resolution-warning").show()}}j.find(".loading-gif").remove()});media_uploader.open()})});