jQuery(document).ready(function(e){e.fn.outerHTML=function(){return(!this.length)?this:(this[0].outerHTML||(function(k){var m=document.createElement("div");m.appendChild(k.cloneNode(true));var l=m.innerHTML;m=null;return l})(this[0]))};e(".zrdn-field-textarea").on("paste",function(l){var k=e(this);window.setTimeout(function(){var m=k.val().split(/\n/);var p=[];for(var o=0;o<m.length;o++){if(/\S/.test(m[o])){p.push(e.trim(m[o]))}}var q=p.join("\n");k.val(q)},500)});e(document).on("click",".zrdn-tablinks",function(){e(".zrdn-tablinks").removeClass("active");e(this).addClass("active");e(".zrdn-tabcontent").removeClass("active");e("#"+e(this).data("tab")).addClass("active");e("input[name=zrdn_active_tab]").val(e(this).data("tab"))});var f=e("#zrdn-preview").html();var b=f.match(/{"@context".*?}}/g,"");if(b){f=f.replace(b[0],"")}var i=/(<.+?>[^<>]*?){([a-zA-Z_].*)_value}([^<>]*?<.+?>)/g;f=f.replace(i,'$1<span id="zrdn_placeholder_$2"></span>$3');e("#zrdn-preview").html(f);e(".prep_time").html('<span id="zrdn_placeholder_prep_time"></span>');e(".cook_time").html('<span id="zrdn_placeholder_cook_time"></span>');e(".zrdn-recipe-image").parent().append('<div class="zrdn-edit-image-text">'+zrdn_editor.str_click_to_edit_image+"</div>");e(".zrdn-field-input").each(function(){var l=e(this).attr("name");if(l==="zrdn_video_url"){return}var k=l.replace("zrdn_","zrdn_placeholder_");e("#"+k).html(e(this).val())});e("input[name=zrdn_video_url]").each(function(){a(e(this))});e("input[type=number]").each(function(){d(e(this))});e(".zrdn-field-textarea").each(function(){c(e(this))});e(".wp-editor-area").each(function(){var l=e(this).attr("name");var k=l.replace("zrdn_","zrdn_placeholder_");e("#"+k).html(e(this).val())});if(e("input[name=zrdn_recipe_image]").val().length>0){e(".zrdn-recipe-image").attr("src",e("input[name=zrdn_recipe_image]").val());var g='<a href="#" style="float:right" class="zrdn_remove_image">'+zrdn_editor.str_remove+"</a>";e(".zrdn-recipe-image").parent().append(g)}e(document).on("click",".zrdn_remove_image",function(){event.preventDefault();e(".zrdn-recipe-save-button input").prop("disabled",true);e(".zrdn-recipe-save-button button").prop("disabled",true);var l=e(this).parent().find(".zrdn-recipe-image");var k=e("input[name=zrdn_recipe_id]").val();e.ajax({type:"POST",url:zrdn_editor.admin_url,dataType:"json",data:({recipe_id:k,nonce:zrdn_editor.nonce,action:"zrdn_clear_image"}),success:function(m){if(m.success){l.attr("src",zrdn_editor.default_image);l.attr("srcset",zrdn_editor.default_image);e("input[name=zrdn_recipe_id]").val(0)}else{l.parent().append(" Clearing image failed...")}e(".zrdn-recipe-save-button button").prop("disabled",false);e(".zrdn-recipe-save-button input").prop("disabled",false)}})});e(document).on("keyup","input[type=text]",function(m){h();var l=e(this).attr("name");if(l==="zrdn_video_url"){return}if(l===undefined){return}if(l.indexOf("zrdn_")===-1){return}var k=l.replace("zrdn_","zrdn_placeholder_");e("#"+k).html(e(this).val())});e(document).on("keyup mouseup","input[type=number]",function(k){d(e(this))});e(document).on("keyup","textarea",function(k){c(e(this))});function d(q){var n=q.attr("name");if(n.indexOf("zrdn_")===-1){return}var m=n.replace("_minutes","").replace("_hours","");var o=parseInt(e("input[name="+m+"_minutes]").val());var k=parseInt(e("input[name="+m+"_hours]").val());var l=m.replace("zrdn_","zrdn_placeholder_");var p="";if(k>0){p+=k+" "+zrdn_editor.str_hours}if(o>0){if(p.length>0){o=", "+o}p+=o+" "+zrdn_editor.str_minutes}e("#"+l).html(p)}function c(n){var l=n.attr("name");if(l.indexOf("zrdn_")===-1){return}var k;var w="UL";var r=l.replace("zrdn_","zrdn_placeholder_");var t=e("#"+r);t.html("");var o=t.outerHTML();if(t.parent().prop("tagName")==="LI"){k=t.parent().parent()}else{k=t.parent()}w=k.prop("tagName");var v=n.val().split("\n");v=v.filter(Boolean);v.forEach(function(z){if(z.substring(0,1)==="!"){o+="</"+w+"><b>"+z.substring(1)+"</b><"+w+">"}else{if(z.substring(0,1)==="%"){var A=/(?:%)([http|https?:\/\/=?\w.-]+(?:\.[\w\.-]+)+[\w\-\._~:\/?#[\]@!\$&'\(\)\*\+,;=.\/]+[a-zA-N])/g;var y=z.match(A);if(y){var x=y[0];var B=x.substring(1);o+=z.replace(x,'<img style="max-width:100%" src="'+B+'">')}}else{o+="<li>"+z+"</li>"}}});if(o.length){var m;var u=/(\*[a-zA-Z\-\_\(\)\<\>\/\\\$\!\@\#\:\;\.\,\?\+\=]*\*)/g;var q=o.match(u);if(q&&q.length){for(m=0;m<q.length;m++){var p=q[m];var s=p;s=s.replace(/\*$/i,"</b>").replace(/^\*/i,"<b>");o=o.replace(p,s)}}u=/\[([^\]\|\[]*)\|([^\]\|\[]*)\]/g;q=o.match(u);if(q&&q.length){for(m=0;m<q.length;m++){o=o.replace(/\[([^\]\|\[]*)\|([^\]\|\[]*)\]/i,'<a href="$1">$2</a>')}}}k.html(o)}var j=null;e(document).on("click",".zrdn-recipe-image",function(){var k=e(this);j=wp.media({frame:"post",state:"insert",multiple:false});j.on("insert",function(){k.wrap('<div class="loading-gif"></div>');e(k).load(function(){k.unwrap()});var o=j.state().get("selection").length;var l=j.state().get("selection").models;for(var n=0;n<o;n++){var m=l[n].id;var p;if(l[n].attributes.sizes.hasOwnProperty("zrdn_recipe_image")){p=l[n].attributes.sizes.zrdn_recipe_image}else{if(l[n].attributes.sizes.hasOwnProperty("large")){p=l[n].attributes.sizes.large}else{p=l[n].attributes.sizes.full}}var q=p.url;k.attr("src",q);e("input[name=zrdn_recipe_image_id]").val(m);e("input[name=zrdn_recipe_image]").val(q)}});j.open()});e(document).on("click",".zrdn-image-reset",function(){var n=e(this);var l=n.closest(".zrdn-field");var k=l.find(".zrdn-image-upload-field");var m=k.attr("name");l.find(".zrdn-image-upload-preview").attr("src",zrdn_editor.image_placeholder);e("input[name="+m+"_id]").val("");e("input[name="+m+"]").val("")});e(document).on("click",".zrdn-image-uploader",function(){var o=e(this);var l=o.closest(".zrdn-field");var k=l.find(".zrdn-image-upload-field");var n=k.data("size");var m=k.attr("name");l.find(".zrdn-image-resolution-warning").hide();j=wp.media({frame:"post",state:"insert",multiple:false});j.on("insert",function(){l.append('<div class="loading-gif"></div>');var s=j.state().get("selection").length;var p=j.state().get("selection").models;for(var r=0;r<s;r++){var q=p[r].id;console.log(p[r]);var t=false;if(p[r].attributes.sizes.hasOwnProperty(n)){t=p[r].attributes.sizes[n]}else{if(p[r].attributes.sizes.hasOwnProperty(n+"_s")){t=p[r].attributes.sizes[n+"_s"]}}console.log(t);if(t){var u=t.url;l.find(".zrdn-image-upload-preview").attr("src",u);e("input[name="+m+"_id]").val(q);e("input[name="+m+"]").val(u)}else{l.find(".zrdn-image-resolution-warning").show()}}l.find(".loading-gif").remove()});j.open()});e(document).on("keyup","input[name=zrdn_video_url]",function(){a(e(this))});function a(n){var l=n.attr("name");if(l===undefined){return}if(l.indexOf("zrdn_")===-1){return}var k=l.replace("zrdn_","zrdn_placeholder_");var m=n.val();e.ajax({type:"GET",url:zrdn_editor.admin_url,dataType:"json",data:({video_url:m,action:"zrdn_get_embed_code"}),success:function(o){if(o.success){e("#"+k).html(o.embed)}}})}setTimeout(function(){for(var k=0;k<tinymce.editors.length;k++){tinymce.editors[k].onChange.add(function(m,o){var n=m.id;var l=n.replace("zrdn_","zrdn_placeholder_");e("#"+l).html(m.getContent())});tinymce.editors[k].onKeyUp.add(function(m,o){var n=m.id;var l=n.replace("zrdn_","zrdn_placeholder_");e("#"+l).html(m.getContent())})}},1000);h();function h(){if(!e("#zrdn-nutrition-label").length){return}var k=e("#zrdn-nutrition-label");if(e("input[name=zrdn_calories]").val().length===0){k.hide()}else{k.show()}}});