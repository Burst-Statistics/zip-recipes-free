jQuery(document).ready(function(j){var b;var g=800;j(document).on("click",".zrdn-add-author",function(){var p=j(".zrdn-template").get(0).outerHTML;j(this).closest(".field-group").find(".zrdn-author-frame").append(p);j(this).closest(".field-group").find(".zrdn-author-frame .zrdn-hidden").removeClass("zrdn-hidden")});j(document).on("click",".zrdn-delete-author",function(){j(this).closest(".zrdn-author-container").remove()});j.fn.outerHTML=function(){return(!this.length)?this:(this[0].outerHTML||(function(p){var r=document.createElement("div");r.appendChild(p.cloneNode(true));var q=r.innerHTML;r=null;return q})(this[0]))};j(".zrdn-field-textarea").on("paste",function(q){var p=j(this);window.setTimeout(function(){var r=p.val().split(/\n/);var t=[];for(var s=0;s<r.length;s++){if(/\S/.test(r[s])){t.push(j.trim(r[s]))}}var u=t.join("\n");p.val(u)},500)});j(document).on("click",".zrdn-tablinks",function(){j(".zrdn-tablinks").removeClass("active");j(this).addClass("active");j(".zrdn-tabcontent").removeClass("active");j("#"+j(this).data("tab")).addClass("active");j("input[name=zrdn_active_tab]").val(j(this).data("tab"))});var l=j("#zrdn-preview");var e=false;o(false);function o(s){s=typeof s!=="undefined"?s:false;if(l.length){var v;var p=[];j(".zrdn-field input").each(function(){var x=j(this).attr("name");if(typeof x==="undefined"){return}v=a(x,j(this).val());p.push(v)});j(".zrdn-field textarea").each(function(){if(j(this).hasClass("wp-editor-area")){return}var x=j(this).attr("name");if(typeof x==="undefined"){return}v=a(x,f(j(this)));p.push(v)});if(s){p.push(s)}var r=j("input[name=zrdn_recipe_id]").val();v=a("recipe_id",r);p.push(v);var t=j("input[name=zrdn_post_permalink]").val();if(t.length===0){return}var q=t+"?mode=zrdn-preview&id="+r;var w;var u;if(!e){l.html('<iframe id="preview_iframe" width="1024" height="0" src="'+q+'"></iframe>');l.find("iframe").attr("src",q).on("load",function(){w=document.getElementById("preview_iframe");u=w.contentDocument.getElementById("zrdn-recipe-container");i(p,j(u));m(w);l.animate({height:"768px"});e=true})}else{w=document.getElementById("preview_iframe");u=w.contentDocument.getElementById("zrdn-recipe-container");i(p,j(u))}}}function i(p,q){for(var r in p){if(p.hasOwnProperty(r)){var t=p[r];var s=q.find(".zrdn-element_"+t.name);if(s.prop("tagName")==="OL"||s.prop("tagName")==="UL"){s.nextAll().remove()}t.value=decodeURIComponent(t.value);s.html((t.value))}}n(p,q);h(p,q);d(p,q)}setTimeout(function(){if(typeof tinymce==="undefined"){return}for(var p=0;p<tinymce.editors.length;p++){tinymce.editors[p].onChange.add(function(q,t){var r=q.id;var s=a(r,q.getContent());o(s)});tinymce.editors[p].onKeyUp.add(function(q,t){var r=q.id;var s=a(r,q.getContent());o(s)})}},1000);function m(r){var p=r.contentWindow.document.body||r.contentDocument.body,q=j(p).height();if(r.oHeight!==q){j(r).height(0);r.style.height=0;j(r).height(q);r.style.height=parseInt(q)+200+"px";r.oHeight=q}}j(document).on("keyup","input[type=text]",function(p){clearTimeout(b);b=setTimeout(o,g)});j(document).on("keydown","input[type=text]",function(p){clearTimeout(b)});j(document).on("keyup mouseup","input[type=number]",function(p){clearTimeout(b);b=setTimeout(o,g)});j(document).on("keydown mousedown","input[type=number]",function(p){clearTimeout(b)});j(document).on("keyup","textarea",function(p){clearTimeout(b);b=setTimeout(o,g)});j(document).on("keydown","textarea",function(p){clearTimeout(b)});function a(p,q){var r=new Object();r.name=p.replace("zrdn_","");r.value=encodeURIComponent(q);return r}function f(p){var y="UL";if(p.attr("name").indexOf("instructions")!=-1){y=j("input[name=zrdn_instructions_list_type]").val()}else{y=j("input[name=zrdn_ingredients_list_type]").val()}var x=p.val();var q="";var w=x.split("\n");w=w.filter(Boolean);w.forEach(function(B){if(B.substring(0,1)==="!"){q+="</"+y+"><b>"+B.substring(1)+"</b><"+y+">"}else{if(B.substring(0,1)==="%"){var C=/(?:%)([http|https?:\/\/=?\w.-]+(?:\.[\w\.-]+)+[\w\-\._~:\/?#[\]@!\$&'\(\)\*\+,;=.\/]+[a-zA-N])/g;var A=B.match(C);if(A){var z=A[0];var D=z.substring(1);q+="<li>"+B.replace(z,'<img style="max-width:100%" src="'+D+'">')+"</li>"}}else{q+="<li>"+B+"</li>"}}});if(q.length){var r;var v=/(\*[a-zA-Z\-\_\(\)\<\>\/\\\$\!\@\#\:\;\.\,\?\+\=]*\*)/g;var t=q.match(v);if(t&&t.length){for(r=0;r<t.length;r++){var s=t[r];var u=s;u=u.replace(/\*$/i,"</b>").replace(/^\*/i,"<b>");q=q.replace(s,u)}}v=/\[([^\]\|\[]*)\|([^\]\|\[]*)\]/g;t=q.match(v);if(t&&t.length){for(r=0;r<t.length;r++){q=q.replace(/\[([^\]\|\[]*)\|([^\]\|\[]*)\]/i,'<a target="_blank" href="$2">$1</a>')}}v=/(\_[a-zA-Z\-\_\(\)\<\>\/\\\$\!\@\#\:\;\.\,\?\+\=]*\_)/g;t=q.match(v);if(t&&t.length){for(r=0;r<t.length;r++){var s=t[r];if(s==="_placeholder_"){return}var u=s;u=u.replace(/\_$/i,"</i>").replace(/^\_/i,"<i>");q=q.replace(s,u)}}}q="<"+y+">"+q+"</"+y+">";return q}j(document).on("click",".zrdn-image-reset",function(){var s=j(this);var q=s.closest(".zrdn-field");var p=q.find(".zrdn-image-upload-field");var r=p.attr("name");q.find(".zrdn-preview-snippet").attr("src",zrdn_editor.image_placeholder);j("input[name="+r+"_id]").val("");j("input[name="+r+"]").val("")});j(document).on("click",".zrdn-image-uploader",function(){var t=j(this);var q=t.closest(".zrdn-field");var p=q.find(".zrdn-image-upload-field");var s=p.data("size");var r=p.attr("name");q.find(".zrdn-image-resolution-warning").hide();media_uploader=wp.media({frame:"post",state:"insert",multiple:false});media_uploader.on("insert",function(){q.append('<div class="loading-gif"></div>');var x=media_uploader.state().get("selection").length;var u=media_uploader.state().get("selection").models;for(var w=0;w<x;w++){var v=u[w].id;var y=false;if(u[w].attributes.sizes.hasOwnProperty(s)){y=u[w].attributes.sizes[s]}else{if(u[w].attributes.sizes.hasOwnProperty(s+"_s")){y=u[w].attributes.sizes[s+"_s"]}else{if(u[w].attributes.sizes.hasOwnProperty("thumbnail")){y=u[w].attributes.sizes.thumbnail}}}if(y){var z=y.url;q.find(".zrdn-preview-snippet").attr("src",z);j("input[name="+r+"_id]").val(v);j("input[name="+r+"]").val(z)}else{q.find(".zrdn-image-resolution-warning").show()}}q.find(".loading-gif").remove()});media_uploader.open()});function h(q,s){var r=new Object();var p=new Object();var w=new Object();for(var u in q){if(q.hasOwnProperty(u)){var v=q[u];var t=v.name;if(t.indexOf("prep")!=-1){if(t.indexOf("minute")!==-1){r.minutes=v.value}if(t.indexOf("hour")!==-1){r.hours=v.value}}if(t.indexOf("cook")!=-1){if(t.indexOf("minute")!==-1){p.minutes=v.value}if(t.indexOf("hour")!==-1){p.hours=v.value}}if(t.indexOf("wait")!=-1){if(t.indexOf("minute")!==-1){w.minutes=v.value}if(t.indexOf("hour")!==-1){w.hours=v.value}}}s.find(".zrdn-element_prep_time").html(k(r.hours,r.minutes));s.find(".zrdn-element_cook_time").html(k(p.hours,p.minutes));s.find(".zrdn-element_wait_time").html(k(w.hours,w.minutes));s.find(".zrdn-element_total_time").html(k(parseInt(r.hours)+parseInt(p.hours),parseInt(r.minutes)+parseInt(p.minutes)))}}function k(p,q){var r="";if(p>0){r+=p+" "+zrdn_editor.str_hours}if(q>0){if(r.length>0){q=", "+q}r+=q+" "+zrdn_editor.str_minutes}return r}function n(p,r){if(!j("#zrdn-nutrition-label").length){return}var q=c(p,"calories");var s=r.find("#zrdn-nutrition-label");if(parseInt(q.value)===0){s.hide()}else{s.show()}}function d(p,q){var r=c(p,"video_url");var s=r.value;j.ajax({type:"GET",url:zrdn_editor.admin_url,dataType:"json",data:({video_url:s,action:"zrdn_get_embed_code"}),success:function(t){if(t.success){q.find(".zrdn-element_"+r.name).html(t.embed)}}})}function c(p,q){for(var r in p){if(p.hasOwnProperty(r)){var s=p[r];if(s.name===q){return s}}}return false}});